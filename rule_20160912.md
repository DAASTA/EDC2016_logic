# 规则设定

## 规则概述

这是一个在黑白色地图上抢占目标点的游戏。
其他影响游戏的因素有：无人机，道具。

- 地图为不连续的黑色白色区域。比赛开始前地图不公开。
- 选手需抢占地图上指定的点，即**目标点**。目标点的设计是地图的一部分，一张地图目标点的数量是有限的。
- 游戏按照虚拟血量决定胜负。影响血量的因素有
    - 地图：以目标点坐标的颜色为**白色**为例：移动到黑色区域的小车直接扣血。当两辆小车都在白色区域内时，距离目标点比较远的小车扣血。
        - 在抢占点存在的时刻，至少有一个小车会受到来自地图的攻击。
        - 若双方距离目标点的距离一样远，双方同时扣血。
        - 在使用“黑白颠倒”的时刻：目标点立即变成另外一个黑白不同的点，且按照新的目标点的颜色更新黑白扣血逻辑，即**安全区域的颜色始终和目标点的颜色相同**。
    - 无人机：无人机投影点附近小车的血量将受到影响。
        - 当目标点为白色时，无人机附近大范围小车额外回血；当目标点为黑色时，无人机附近小范围小车额外扣血。
        - 在目标点存在的时刻，无人机的扣血/回血效果不会被打断，且始终不分敌我。
        - 游戏开始时，无人机处于自动飞行状态；从玩家使用“制空权”开始的一段时间内，此玩家获得飞机的控制权。
    - 道具：地图上的HP道具可以回复血量。
- 场地上最多2个道具。玩家接触到道具之后，道具立即生效。
    - 道具种类有：
        - AC 制空权：控制一小段时间的无人机。
        - BW 黑白颠倒：立即交换地图的黑白扣血逻辑。
        - HP：回复生命值。
        - None：（无效道具，通讯占位用。）

## 小车

- 只能使用组委会提供的电机。选手**必须**使用自行设计制作的驱动模块(例如L298N)驱动电机。 
- 比赛小车需要在驱动模块和电机之间安装由组委会提供的电源管理模块（通讯模块），并现场进行验证。
    - 比赛过程中，若由于开发者的失误使得电源管理模块出现问题，此场比赛作废重新开始；
    - 禁止改装电源管理模块；禁止试图越过电源管理模块控制电机。违者禁赛。
- 小车的静止长宽和重量不能超过限制。
- 比赛时允许小车之间合理的碰撞和推挤。裁判将裁定碰撞是否恶意，其中被判定为“故意破坏对方小车结构”的选手将立即判负(作血量立即归零处理)。
    - 在小车出现损坏的时刻，一方选手一场比赛可以请求一次暂停并要求裁决（但可被裁判立即驳回，而不暂停比赛，进而此选手此场比赛不能再次请求暂停）。暂停判定有效时，双方选手同时有从接触小车到放回小车30秒时间重新部署小车。
- 小车需要按照要求安装定位色块，否则无法参加比赛。

## 道具

- 道具是通过上位机虚拟的物品。放置在某一个坐标上。
- 当小车的判定点，和虚拟物品的坐标的距离在一定范围内时，选手立即获得道具且道具立即生效。
- 除了地图边缘区域之外，道具可能出现在任何位置（不论黑色白色）。

## 赛制

### 预赛 

初定日期 10.22

预赛规则：

- 一场测试只有一组选手参加。
- 场上只有一个一种道具“HP”。道具定时刷新。不会出现“颠倒黑白”道具。
- 地图为白色环形。
- 不涉及无人机。

分级设定：

- 每组选手将获得一个预赛的等级。
- 等级将用于初赛小组赛的分组。此等级不影响决赛。

在约定的时间内，按照以下次序逐个判定：
（完成了任务A即得到等级A，否则继续判定任务B是否完成）

- A: 得到"+HP"道具>=2次。
- B: 在白色区域内绕场2圈及以上。
- C: 能够在地图范围内前进和转弯。
- D: 队长携小车签到。

### 初赛

初定日期 11.12

小组赛设定：

- 按照预赛等级分组。
- 小组循环赛排名靠前的队伍进入决赛。
    - (世界杯规则) 取胜得3分，平局得1分；
    - 小分顺序为 净胜时间(胜利后剩余的时间-失败后剩余的时间)，净胜血量，绝对血量；

初赛规则：

- 一场比赛有两组选手对抗
    - 一方血量到0，或者游戏时间耗尽，都会导致游戏结束。
    - 游戏结束时，血量高的一方获胜，否则平局。
- 无人机由上位机虚拟。

### 决赛

初定日期 11.19

淘汰赛。

若出现初赛定义的平局，则立即进入加时：

- 加时阶段，双方的血量都会有一个额外的，固定速率的，扣血损失。
- 若出现双方血量同时到0，则双方立即同时恢复30%的血量，继续加时。
- 直到加时结束或一方先归零分出胜负为止；耗时太长则由裁判决定胜利方。

## 通讯细则

- 上位机同小车相互通讯。
- 上位机控制无人机的行动，同时获得无人机拍摄得到的图像。
- 上位机通过定位系统获得无人机的三维坐标和小车的二维坐标。

### 上位机 -> 小车

- 小车坐标(16*2)
- 目标点坐标(16)
- 无人机的投影坐标(16)
- 小车的血量(8*2)
- 道具坐标(16)
- 道具类型(2)
- 游戏时间(14)
- 小车的状态
    - 目标点是否存在(1)，目标点颜色(1)
    - 受到的地图伤害(2)
    - 是否受到飞机伤害(1)
    - 是否被飞机回血(1)
    - 是否正在控制飞机(1)

舍弃

- 小车所在地的颜色(黑白)

### 小车 -> 上位机

- 控制飞机的行动
    - 前后左右，转高空转低空
- //通讯检验信息 ??



---

> 以下是规则初稿/草稿


开发组(上位机)控制**一架**:rocket:在场地中行动，每个队伍的:police_car:与:rocket:形成互动。

特定的情况下，选手可以获得无人机:rocket:的部分控制权。

选手的前期开发时，开发组只会针对无人机:rocket:给出一个模拟程序：输入为选手的控制代码，输出为无人机:rocket:的坐标/姿态。

### Plan A1 争夺制空权

无人机

- 为了稍微减低炸机的概率，上位机对无人机有绝对的控制权。
    - 没有选手有控制权时，是巡航状态，持续给出伤害/补给效果
    - 选手是有机会控制无人机的，但上位机会对选手的指令进行过滤。
    - 无人机提供的指令有：前后左右，切换到某个高度
- 按照飞行的高度切换飞机的功能。但具体判定是按照飞机的实际飞行高度判断的，所以会有一定的时间差。
    - 低空：攻击模式，持续对小范围内的**双方小车**造成伤害
    - 高空：补给模式，持续对大范围内的**非敌方小车**回复生命值。(飞机中立时，双方都回血。)

地图 **<待定>**

- 地图通过黑白划定，踏入黑色地带会持续扣血。
    - 然而就是有一些好道具会出现在黑色地带
    - 选手最好记住场地上有哪些安全的位置，即时退出到安全地带
- 地图上会出现特殊道具“制空权”，成功采集的小车将可以通讯接口控制飞机的行动一小段时间
    - 其他可能的道具：
    - 防御（一段时间不受到伤害） 
    - 撤销制空权（无人机立即恢复中立）
    - 安全区指示物（没有功能，只是告诉你道具所在地是白色的） 
- 由于无人机在不断的巡航中，所以就算没有“制空权”，也需要不断的躲避或者追赶

道具

相撞


## Plan B <仅限决赛> 每个队伍都有 :police_car: :rocket: 

### Plan B1 标准四旋翼 <场上每次会出现一架无人机，比赛2次互换攻防>

比赛进行2次，两个队伍的无人机分别上场，作为攻击方。2次比赛后，积分多的队伍获得胜利。

- 和 Plan A1 类似，但无人机锁定由其中一方控制。
- 场地上还是有各类防御道具（不会出现变更无人机控制权的道具）

### Plan B2 微型四旋翼 <场上可以同时出现两架无人机> <希望能出现2支这样的队伍>

- 和 Plan B1 类似，但双方都有固定归属的无人机同时上场
