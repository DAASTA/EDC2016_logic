# 规则

比赛采取1V1对抗模式，在黑白两色图案组成的地图中进行。

小车以抢点为主要目标。比赛过程中，目标点、道具、无人机等多种因素都会影响小车生命值。

一方生命值归零或时间用尽时比赛结束。结束时生命值较多的队伍获胜。

## 小车

- 官方提供
    - 框架（亚克力板，铜柱）。
        - 静态长宽禁止超过20cm。
        - 允许对框架的合理改装（钻孔、重新组合等）。允许自行设计框架结构。
    - 控制器（单片机/FPGA/DSP）
        - 比赛时，禁止和自己的电脑等外部设备进行交互。
        - 不能使用Arduino。
    - 电机
        - 必须使用官方规定型号的电机
    - 通讯板
        - 比赛时，必须使用官方通讯板
        - 比赛时，禁止干扰通讯模块
    - 定位色块
        - 比赛时，必须安装定位色块
        - 比赛时，禁止干扰定位模块
- 自行设计
    - 传感器
        - 允许使用现成的模块。
    - 驱动电路板
        - 禁止抄袭PCB设计。
        - 不能使用现成的模块。
        - 可以在李兆基大楼印制。可以外包制作。
    - 其他合理的机械结构
        - 静态时（复位时）长宽禁止超过20cm
        - 禁止使用锐器。禁止破坏场地。
- 允许合理的物理对抗
    - 允许合理的碰撞、推挤、冲击。
    - 禁止破坏对方小车物理结构，包括破坏框架，破坏连线，造成短路等。
    - 禁止限制对方小车行动，包括架空动力轮，锁死小车，掀翻小车等。
    - 禁止使用水、墨等破坏小车或地图。

## 地图和定位

- 地图尺寸为2.56m*2.56m，由黑白两色组成。
    - 不保证黑色或白色区域连续。如果尝试寻迹，请注意寻迹策略的选择。
- 在定位尺寸为256*256，即一个单位为1cm。
    - 定位信息将持续通过通讯模块告知选手。XY两个坐标的范围为0x00~0xFF。注意地图XY坐标默认为**左手系**，请以实际场地为准。
- 当选手出界时，通讯模块会发出出界警告。
    - 越界的X或Y坐标会保持0x00或0xFF（由出界方向决定），未越界的坐标仍然保持尽可能正确的值。
    - 出界时，小车将受到持续4HP/s伤害。
    - 处于出界状态时，小车以尽可能正确的坐标参与地图逻辑。即占点、道具、无人机等活动仍然有效。

## 目标点

- 目标点
    - 同一时刻最多只有一个。
    - 位置随机，所在坐标的地图颜色决定了目标点的颜色。
    - 争抢完毕后自动消失，消失后一段时间内自动刷新。
- 占点：目标点存在时，总有一或零辆小车处于占点状态。非占点的一或两辆小车将持续扣除生命值。
    - 小车的初始血量为200HP。小车的血量范围为0HP~200HP。
    - 小车所在点的颜色和目标点颜色相同即可占点；若两辆小车的颜色都正确，则距离目标点比较近为占点。
    - 当占点小车距离目标点的距离小于20单位时，非占点小车以8HP/s的速度扣血。否则，非占点的小车以2HP/s的速度扣血。
    - 非占点小车受到的伤害，称为目标点造成的伤害。当一个目标点累积造成40HP伤害后，目标点消失。
        - 一个目标点存在的时长为5s~20s。
    - 在目标点消失之后3s，随机产生一个新的目标点。

## 无人机

> 完整的无人机规则只适用于决赛。合适时无人机将由上位机模拟以进行测试。

- 无人机有攻击和治疗两种状态，对其投影点附近一定范围内的小车产生影响。选手可通过通讯模块获得无人机的位置坐标。
- 无人机状态由当前目标点颜色决定：
    - 目标点为黑色：无人机变为攻击状态，半径37.5单位，攻击速度8HP/s。*在争抢目标点时配合使用杀伤力极大。*
    - 目标点为白色：无人机变为治疗状态，半径60单位，回复速度4HP/s。*可以大大延长游戏的时间。*
    - 目标点消失时，无人机状态保持不变。
- 无人机在默认情况下的目标位置为当前目标点所在位置。当选手使用道具制空权时，选手可以利用通讯模块发送指令指定无人机的目标点，控制无人机的行动。

## 道具

- 恢复生命
    - 立即增加生命值40HP。
- 黑白颠倒
    - 当前目标点立即消失，并立即产生一个和当前目标点颜色不同的目标点，飞机状态也立即随之改变。
        - 若当前目标点不存在，参考当前无人机的状态颜色。
        - *总之可以立即刷出一个明确知道颜色的目标点。*
- 制空权
    - 小车可以在10s内控制无人机的行动。
    - 此道具的使用意味着上一次制空权的效果立即终止。
- 场上最多有一个道具。
- 小车只要距离道具在20单位内，道具立即自动生效。
- 道具的冷却时间为3s。
- 如果持续15s道具都没有被吃掉，道具会自动刷新。

## 通讯

- 请参考通讯协议。
- 坐标分辨率一律为0x00~0xFF，这样16位可以表示一个二维坐标。
- 上位机->小车
    - 小车坐标(16*2)
    - 目标点坐标(16)
    - 无人机的投影坐标(16)
    - 小车的血量(8*2)
    - 道具坐标(16)
    - 道具类型(2)
    - 游戏时间(14)
    - 小车的状态
        - 目标点是否存在(1)，目标点颜色(1)
        - 受到目标点伤害(1)，受到大量的目标点伤害(1)
        - 是否受到飞机伤害(1)
        - 是否被飞机回血(1)
        - 自己是否正在控制飞机(1)
- 小车->上位机
    - 无人机目标点坐标(16)

## 请求暂停

裁判可以自由暂停比赛。

在比赛开始后，若出现以下情况，选手可以主动请求暂停：

- 小车出界
- 小车结构损坏
- 小车出现其他异常行为    

在一次正式比赛中，每队选手可以在比赛中向裁判**2次**请求暂停。

- 裁判可以先暂停比赛，再考虑是否驳回。若被驳回，视作选手失去1次请求暂停机会。
- 当暂停生效时，若**请求方**的小车处于出界状态，**请求方**小车瞬间受到40HP惩罚。
- 暂停生效后，从裁判指示的30s时间内，**双方**选手可以接触和修复自己的小车，并在指定时间内放回到场地内。


## 规则整理

### 标准规则

#### 血量

- 所在点颜色：黑；白
- 出界：无0HP/s；出界-4HP/s；暂停 -40HP
- 目标点：抢到0HP/s；普攻 -2HP/s；暴击 -8HP/s
- 目标点血量：40HP
- 无人机：无0HP/s；回复 +4HP/s；攻击 -8HP/s
- 无人机控制权：有；无
- 道具：回复+40HP
- 小车血量：上限200HP，下限0HP

#### 距离量

- 地图尺寸：256
- 无人机：攻击半径37.5，治疗半径60
- 目标点：近占半径20
- 道具：接触半径20，产生道具的回避距离90，产生道具回避边界距离20
- 距离计算用欧氏距离。

#### 时间量

- 逻辑频率 10Hz
- 总时间 180s
- 制空权时间 10s
- 目标点冷却时间 3s
- 道具冷却时间 3s，道具自动刷新时间 15s

#### 胜负判定

1. KO对手时剩余的时间长度。
1. 比赛时间耗尽时，双方的血量差距。

### 样车规则

#### 血量

- 所在点颜色：黑-8HP/s；白-2HP/s
- 出界：无0HP/s；出界-4HP/s；暂停 -40HP
- 目标点不存在
- 无人机不存在
- 道具：回复+40HP
- 小车血量：没有上下限

#### 胜负判定

比赛时间耗尽时，剩余血量。

# 赛程

### 开发套件领取

第4周 10.4 ~ 

### 预审

第6周周日 10.23

- 一场测试只有一组选手参加。
- 地图中存在环形通路。
- 不涉及无人机。

以下是评级标准。*评级只影响初赛分组。*

- A: 能抢点
    - 能够在目标点消失前(5s~20s)移动到目标点范围内(20单位)，并在目标点上等待目标点的消失。之后再进行下一个目标点的争抢。需要有明显的停止动作。重复完成以上动作2次及以上。
    - 等价完成条件：完成了通讯模块的接收，小车能够按照抢点算法完成抢点。
- B: 能绕场
    - 在白色/黑色区域内绕场2圈及以上。
    - 等价完成条件：完成了红外传感器（或者通讯模块的接收），单片机能够利用传感器输入决策和控制电机。
- C: 能行动
    - 能够在地图范围内依次完成前进和转弯动作。
    - 等价完成条件：单片机能够控制电机。
- D: 能动
    - 等价完成条件：小车结构完成，电机功能正常。

在预审中，如果使用了现成的电机驱动模块（初赛决赛中不得使用），评级降低一档。

### 初赛

第9周周末 11.12/11.13

初赛中，必须使用自行设计的电机驱动板。

#### 小组赛(3组分别取前4)

- 分为3组，按照预赛分组平均分配，每组使用一张不同的地图。
- 所有选手都和样车进行对战，使用**样车规则**，按照180s后的血量进行排名。
- 每组1~4名进入决赛，5~6名进入复活赛。

#### 复活赛(6进4)

- 抽签分为3+3两组。
- 每个小组进行循环赛，每组3场比赛分别使用3张地图，使用**标准规则**。
- 每组前1~2名进入决赛。

### 决赛

初定日期 11.27

淘汰赛