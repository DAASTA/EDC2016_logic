# 规则

比赛采取1V1对抗模式，在黑白两色图案组成的地图中进行。

小车以抢点为主要目标。比赛过程中，目标点、道具、无人机等多种因素都会影响小车生命值。

一方生命值归零或时间用尽时比赛结束。结束时生命值较多的队伍获胜。

## 小车

- 官方提供
    - 框架（亚克力板，铜柱）。
        - 静态长宽禁止超过20cm。
        - 允许对框架的合理改装（钻孔、重新组合等）。允许自行设计框架结构。
    - 控制器（单片机/FPGA/DSP）
        - 比赛时，禁止和自己的电脑等外部设备进行交互。
        - 不能使用Arduino。
    - 电机
        - 必须使用官方规定型号的电机
    - 通讯板
        - 比赛时，必须使用官方通讯板
        - 比赛时，禁止干扰通讯模块
    - 定位色块
        - 比赛时，必须安装定位色块
        - 比赛时，禁止干扰定位模块
- 自行设计
    - 传感器
        - 允许使用现成的模块。
    - 驱动电路板
        - 禁止抄袭PCB设计。
        - 不能使用现成的模块。
        - 可以在李兆基大楼印制。可以外包制作。
    - 其他合理的机械结构
        - 静态时（复位时）长宽禁止超过20cm
        - 禁止使用锐器。禁止破坏场地。
- 允许合理的物理对抗
    - 允许合理的碰撞、推挤、冲击。
    - 禁止破坏对方小车物理结构，包括破坏框架，破坏连线，造成短路等。
    - 禁止限制对方小车行动，包括架空动力轮，锁死小车，掀翻小车等。
    - 禁止使用水、墨等破坏小车或地图。

## 地图和定位

- 地图尺寸为2.56m*2.56m，由黑白两色组成。
    - 不保证黑色或白色区域连续。如果尝试寻迹，请注意寻迹策略的选择。
- 在定位尺寸为256*256，即一个单位为1cm。
    - 定位信息将持续通过通讯模块告知选手。XY两个坐标的范围为0x00~0xFF。注意地图XY坐标默认为**左手系**，请以实际场地为准。
- 当选手出界时，通讯模块会发出出界警告。
    - 越界的X或Y坐标会保持0x00或0xFF（由出界方向决定），未越界的坐标仍然保持尽可能正确的值。
    - 当某一方小车持续处在出界状态时（无法主动回到赛场上），裁判将暂停比赛。出界方在此瞬间给予40HP惩罚。然后*工作人员*将小车重新放回场内，比赛继续。
        - 多次出界会直接导致失败。*允许使用强行推挤出界的方法快速KO对手。*

## 目标点

- 目标点
    - 同一时刻最多只有一个。
    - 位置随机，所在坐标的地图颜色决定了目标点的颜色。
    - 争抢完毕后自动消失，消失后一段时间内自动刷新。
- 占点：目标点存在时，总有一或零辆小车处于占点状态。非占点的一或两辆小车将持续扣除生命值。
    - 小车的初始血量为200HP。小车的血量范围为0HP~200HP。
    - 小车所在点的颜色和目标点颜色相同即可占点；若两辆小车的颜色都正确，则距离目标点比较近为占点。
    - 当占点小车距离目标点的距离小于20单位时，非占点小车以8HP/s的速度扣血。否则，非占点的小车以2HP/s的速度扣血。
    - 非占点小车受到的伤害，称为目标点造成的伤害。当一个目标点累积造成40HP伤害后，目标点消失。
        - 一个目标点存在的时长为5s~20s。
    - 在目标点消失之后3s，随机产生一个新的目标点。


## 无人机

> 完整的无人机规则只适用于决赛。合适时无人机将由上位机模拟以进行测试。

- 无人机有攻击和治疗两种状态，对其投影点附近一定范围内的小车产生影响。选手可通过通讯模块获得无人机的位置坐标。
- 无人机状态由当前目标点颜色决定：
    - 目标点为黑色：无人机变为攻击状态，半径37.5单位，攻击速度8HP/s。*在争抢目标点时配合使用杀伤力极大。*
    - 目标点为白色：无人机变为治疗状态，半径60单位，回复速度4HP/s。*可以大大延长游戏的时间。*
    - 目标点消失时，无人机状态保持不变。
- 无人机在默认情况下自动巡航地图。当选手使用道具制空权时，选手可以利用通讯模块发送指令指定无人机的目标点，控制无人机的行动。

## 道具

- 恢复生命
    - 立即增加生命值40HP。
- 黑白颠倒
    - 当前目标点立即消失，并立即产生一个和当前目标点颜色不同的目标点，飞机状态也立即随之改变。
        - 若当前目标点不存在，参考当前无人机的状态颜色。
        - *总之可以立即刷出一个明确知道颜色的目标点。*
- 制空权
    - 小车可以在10s内控制无人机的行动。
    - 此道具的使用意味着上一次制空权的效果立即终止。
- 场上最多有一个道具。
- 小车只要距离道具在20单位内，道具立即自动生效。
- 道具的冷却时间为3s。
- 如果持续15s道具都没有被吃掉，道具会自动刷新。

## 通讯

- 请参考通讯协议。
- 坐标分辨率一律为0x00~0xFF，这样16位可以表示一个二维坐标。
- 上位机->小车
    - 小车坐标(16*2)
    - 目标点坐标(16)
    - 无人机的投影坐标(16)
    - 小车的血量(8*2)
    - 道具坐标(16)
    - 道具类型(2)
    - 游戏时间(14)
    - 小车的状态
        - 目标点是否存在(1)，目标点颜色(1)
        - 受到目标点伤害(1)，受到大量的目标点伤害(1)
        - 是否受到飞机伤害(1)
        - 是否被飞机回血(1)
        - 自己是否正在控制飞机(1)
- 小车->上位机
    - 无人机目标点坐标(16)

# 赛程

### 开发套件领取

暂定时间 10.7 左右

### 预审

暂定时间 10.23

- 一场测试只有一组选手参加。
- 地图中存在环形通路。
- 不涉及无人机。

以下是评级标准。评级只影响初赛分组。

- A: 能抢点
    - 能够在目标点消失前(5s~20s)移动到目标点范围内(20单位)，并在目标点上等待目标点的消失。之后再进行下一个目标点的争抢。需要有明显的停止动作。重复完成以上动作2次及以上。
    - 等价完成条件：完成了通讯模块的接收，小车能够按照抢点算法完成抢点。
- B: 能绕场
    - 在白色/黑色区域内绕场2圈及以上。
    - 等价完成条件：完成了红外传感器（或者通讯模块的接收），单片机能够利用传感器输入决策和控制电机。
- C: 能行动
    - 能够在地图范围内依次完成前进和转弯动作。
    - 等价完成条件：单片机能够控制电机。
- D: 能动
    - 等价完成条件：小车结构完成，电机功能正常。

在预审中，如果使用了现成的电机驱动模块（初赛决赛中不得使用），评级降低一档。

### 初赛

初定日期 11.13

小组赛

- 按照预赛等级分组。具体情况视预赛情况决定。
- 小组循环赛排名靠前的队伍进入决赛。
    - (世界杯规则) 取胜得3分，平局得1分；
    - 小分顺序为 
        - (1)净胜时间（胜利后剩余的时间-失败后剩余的时间）
        - (2)净胜血量
        - (3)绝对血量

初赛中无人机由上位机虚拟。

### 决赛

初定日期 11.27

淘汰赛